{% extends "base.html" %}

{% block title %}{{ data.sport|upper }} {{ data.position|upper }} Performances{% endblock %}

{% block content %}
<div class="page-header">
    <h2>{{ data.sport|upper }} {{ data.position|upper }}</h2>
    <p class="updated-time">Last updated: {{ data.generated_at }}</p>
    {% if 'total_performances' in data %}
    <p class="performance-count">Total rare performances: {{ data.total_performances }}</p>
    {% endif %}
</div>

{% if data.rare_performances %}
<div class="performances">
    {% for perf in data.rare_performances %}
    <div class="perf-card {{ perf.rarity.classification }}">
        <div class="perf-header">
            <h3>{{ perf.game.player_name }}</h3>
            <span class="rarity-label {{ perf.rarity.classification }}">{{ perf.rarity.classification|replace('_', ' ')|title }}</span>
        </div>

        <div class="perf-details">
            <div class="game-info">
                <p><strong>{{ perf.game.team }}</strong> vs {{ perf.game.opponent }}</p>
                <p>{{ perf.game.game_date }} (Week {{ perf.game.week }}, {{ perf.game.season }})</p>
            </div>

            <div class="stats">
                {% if data.position == 'qb' %}
                    <div class="stat-group">
                        <span class="stat-label">Pass Yards</span>
                        <span class="stat-value">{{ perf.game.pass_yards }}</span>
                    </div>
                    <div class="stat-group">
                        <span class="stat-label">Pass TDs</span>
                        <span class="stat-value">{{ perf.game.pass_td }}</span>
                    </div>
                    <div class="stat-group">
                        <span class="stat-label">Completions</span>
                        <span class="stat-value">{{ perf.game.completions }}</span>
                    </div>
                    <div class="stat-group">
                        <span class="stat-label">Interceptions</span>
                        <span class="stat-value">{{ perf.game.interceptions }}</span>
                    </div>
                {% elif data.position == 'rb' %}
                    <div class="stat-group">
                        <span class="stat-label">Rush Yards</span>
                        <span class="stat-value">{{ perf.game.rush_yards }}</span>
                    </div>
                    <div class="stat-group">
                        <span class="stat-label">Rush TDs</span>
                        <span class="stat-value">{{ perf.game.rush_td }}</span>
                    </div>
                    <div class="stat-group">
                        <span class="stat-label">Attempts</span>
                        <span class="stat-value">{{ perf.game.rush_attempts }}</span>
                    </div>
                    <div class="stat-group">
                        <span class="stat-label">Fumbles</span>
                        <span class="stat-value">{{ perf.game.fumbles_lost }}</span>
                    </div>
                {% elif data.position in ['wr', 'te'] %}
                    <div class="stat-group">
                        <span class="stat-label">Receptions</span>
                        <span class="stat-value">{{ perf.game.receptions }}</span>
                    </div>
                    <div class="stat-group">
                        <span class="stat-label">Rec Yards</span>
                        <span class="stat-value">{{ perf.game.receiving_yards }}</span>
                    </div>
                    <div class="stat-group">
                        <span class="stat-label">Rec TDs</span>
                        <span class="stat-value">{{ perf.game.receiving_td }}</span>
                    </div>
                    <div class="stat-group">
                        <span class="stat-label">Targets</span>
                        <span class="stat-value">{{ perf.game.targets }}</span>
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="rarity-info">
            <p><strong>Rarity Score:</strong> {{ perf.rarity.rarity_score }}/100</p>
            <p><strong>Occurred:</strong> {{ perf.rarity.occurrence_count }} times in history</p>
            {% if perf.rarity.last_occurrence %}
            <p><strong>Last occurrence:</strong> {{ perf.rarity.last_occurrence.player_name }} ({{ perf.rarity.last_occurrence.game_date }})</p>
            {% endif %}
            <div class="rarity-buckets">
                <small>
                Stat buckets:
                {% if data.position == 'qb' %}
                    {{ perf.game.pass_yards_bucket }} pass yards, {{ perf.game.pass_td_bucket }} pass TDs, {{ perf.game.interceptions_bucket }} INTs
                {% elif data.position == 'rb' %}
                    {{ perf.game.rush_yards_bucket }} rush yards, {{ perf.game.rush_td_bucket }} rush TDs, {{ perf.game.fumbles_bucket }} fumbles
                {% elif data.position in ['wr', 'te'] %}
                    {{ perf.game.receptions_bucket }} receptions, {{ perf.game.receiving_yards_bucket }} rec yards, {{ perf.game.receiving_td_bucket }} rec TDs
                {% endif %}
                </small>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="no-data">
    <h3>No rare performances found</h3>
    <p>Either no data is available yet, or no performances met the rarity criteria in this time period.</p>
</div>
{% endif %}
{% endblock %}